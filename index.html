<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Knowvion — Login</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { margin:0; font-family:"Poppins",sans-serif; background:#f8f9fa; display:flex; justify-content:center; align-items:center; height:100vh; }
  .login-container { background:#ffffff; padding:40px 30px; border-radius:15px; box-shadow:0 12px 30px rgba(0,0,0,0.1); width:100%; max-width:400px; text-align:center; }
  h2 { margin-bottom:20px; color:#333; }
  input { width:100%; padding:12px 15px; margin:10px 0; border-radius:8px; border:1px solid #ccc; font-size:16px; box-sizing:border-box; }
  button { width:100%; padding:12px; margin-top:15px; background:#007aff; color:#fff; font-weight:600; border:none; border-radius:8px; cursor:pointer; font-size:16px; transition:0.2s; }
  button:hover { background:#0064e6; }
  .info { font-size:14px; color:#555; margin-top:12px; }
  .info a { color:#007aff; text-decoration:none; }
  .info a:hover { text-decoration:underline; }
  .success { color:green; margin-top:10px; }
  .error { color:red; margin-top:10px; }
</style>
</head>
<body>

<div class="login-container">
  <h2>Login to Knowvion</h2>
  <input type="email" id="email" placeholder="Enter your email" required />
  <button id="loginBtn">Send Magic Link</button>
  <div class="success" id="successMsg"></div>
  <div class="error" id="errorMsg"></div>
  <div class="info">Don't have an account? <a href="#" id="registerLink">Register</a></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
  const supabaseUrl = 'https://rzdigwqgejbowdljuuei.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6ZGlnd3FnZWpib3dkbGp1dWVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2Mjc2MTgsImV4cCI6MjA3NzIwMzYxOH0.WlTlj3Vr4euv7EOzxNCNHB4rqZQeglPO07V9IBnUoJY';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  const emailInput = document.getElementById('email');
  const loginBtn = document.getElementById('loginBtn');
  const successMsg = document.getElementById('successMsg');
  const errorMsg = document.getElementById('errorMsg');
  const registerLink = document.getElementById('registerLink');

  // If user already logged in → redirect to dashboard
  supabase.auth.getSession().then(({data})=>{
    if(data.session) window.location.href = 'dashboard.html';
  });

  loginBtn.addEventListener('click', async () => {
    const email = emailInput.value.trim();
    if(!email){ errorMsg.textContent = "Please enter a valid email."; successMsg.textContent=""; return; }

    const {error} = await supabase.auth.signInWithOtp({ email, options:{ emailRedirectTo: window.location.origin+'/dashboard.html' } });

    if(error){
      errorMsg.textContent = error.message;
      successMsg.textContent = "";
    } else {
      successMsg.textContent = "Magic link sent! Check your email to login.";
      errorMsg.textContent = "";
    }
  });

  registerLink.addEventListener('click', ()=>{
    const email = emailInput.value.trim();
    if(!email){ alert("Enter your email to register"); return; }
    supabase.auth.signUp({ email }).then(({error})=>{
      if(error) alert(error.message);
      else alert("Registration email sent! Check your inbox.");
    });
  });
</script>
</body>
</html>
