<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Knowvion ‚Äî Dashboard</title>

<!-- Font (Poppins) -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --page-bg: #efefef;       
  --app-bg: #ffffff;        
  --panel: #fbfbfd;         
  --text: #0b0b0b;
  --muted: #6b6b6b;
  --accent: #007aff;
  --shadow-ios: 0 18px 50px rgba(10,10,10,0.08);
  --radius-main: 20px;     
  --radius-small: 8px;     
}
body[data-theme="dark"]{
  --page-bg:#0b0b0b;
  --app-bg:#0b0b0b;
  --panel:#121212;
  --text:#ffffff;
  --muted:#bfbfbf;
  --accent:#0a84ff;
  --shadow-ios: 0 18px 50px rgba(0,0,0,0.75);
}
html,body{height:100%; margin:0; background:var(--page-bg); font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial; -webkit-font-smoothing:antialiased; color:var(--text);}
.app-wrap{width: calc(100% - 48px); height: calc(100% - 48px); margin: 24px; border-radius: var(--radius-main); overflow: hidden; box-shadow: var(--shadow-ios); display: flex; background: var(--app-bg);}
.sidebar {width: 250px; min-width: 70px; background: linear-gradient(180deg,var(--panel),#f0f0f2); padding: 18px 10px; display:flex; flex-direction:column; align-items:stretch; gap:10px; transition: width 200ms ease; border-right: 1px solid rgba(0,0,0,0.04);}
.sidebar.collapsed { width: 76px; }
.logo {display:flex; align-items:center; gap:12px; padding:10px; margin-bottom:4px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3)); justify-content:flex-start;}
.logo .icon {width:44px; height:44px; display:flex; align-items:center; justify-content:center; border-radius:10px; background:var(--app-bg); color:var(--accent); font-weight:700; font-size:18px; box-shadow: 0 8px 20px rgba(0,0,0,0.06);}
.logo .text { font-size:18px; font-weight:700; color:var(--text); }
.sidebar .nav {display:flex; flex-direction:column; gap:6px; padding:6px;}
.nav a {display:flex; align-items:center; gap:12px; padding:10px 12px; color:var(--text); text-decoration:none; border-radius:12px; transition: background 150ms, transform 120ms; font-weight:600;}
.nav a:hover{ background: rgba(0,0,0,0.04); transform: translateX(4px); }
.nav .label { opacity:1; transition:opacity 150ms ease; }
.sidebar.collapsed .nav .label { opacity:0; pointer-events:none; width:0; display:inline-block; }
.nav .logout { margin-top:8px; color:#c33; font-weight:700; }
.main {flex:1; display:flex; flex-direction:column; gap:14px; padding:18px 22px; overflow:auto; background: transparent;}
.top-row {display:flex; justify-content:space-between; align-items:center; gap:10px;}
.top-row .left { display:flex; align-items:center; gap:12px; }
.top-row .right { display:flex; align-items:center; gap:10px; margin-left:auto; }
.quick-btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; background:var(--panel); border-radius:12px; padding:8px 12px; border:none; cursor:pointer; box-shadow: 0 8px 24px rgba(0,0,0,0.04); transition: transform 130ms; color:var(--text); }
.quick-btn:hover { transform: translateY(-3px); }
.banner { width:100%; height:140px; border-radius:8px; overflow:hidden; box-shadow: 0 12px 34px rgba(0,0,0,0.06); background-position:center; background-size:cover; }
#contentLoader { margin-top:8px; padding:6px 2px 80px 2px; }
.card { background:var(--panel); padding:14px; border-radius:10px; box-shadow: 0 8px 18px rgba(0,0,0,0.04); margin-bottom:12px; }
.card h3{ margin:0 0 8px 0; }
.muted{ color:var(--muted); font-size:14px; }
.cookie { position:fixed; right:22px; bottom:22px; background:var(--panel); color:var(--text); padding:10px 12px; border-radius:12px; box-shadow: var(--shadow-ios); z-index:60; display:flex; gap:10px; align-items:center; }
.cookie button{ background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
@media (max-width:900px){ .app-wrap { margin:10px; } .sidebar { position:fixed; z-index:80; left:0; top:0; bottom:0; } .sidebar.collapsed { width:68px; } .main { margin-left:68px; } }
</style>
</head>
<body>

<div class="app-wrap" role="application">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar" aria-label="Sidebar navigation">
    <div class="logo" role="img" aria-label="Knowvion logo">
      <div class="icon">K</div>
      <div class="text">Knowvion</div>
    </div>

    <nav class="nav" role="navigation" aria-label="Main sections">
      <a href="home.html" data-section="home"><span class="label">Home</span></a>
      <a href="courses.html" data-section="courses"><span class="label">Courses</span></a>
      <a href="ai.html" data-section="ai"><span class="label">AI Section</span></a>
      <a href="profile.html" data-section="profile"><span class="label">Profile</span></a>
      <a href="#" data-section="logout" class="logout" id="navLogout"><span class="label">Logout</span></a>
    </nav>
  </aside>

  <!-- MAIN -->
  <div class="main" role="main">
    <div class="top-row">
      <div class="left"></div>
      <div class="right">
        <button class="quick-btn" id="btnNotifications" title="Open notifications">üîî</button>
        <button class="quick-btn" id="btnProfile" title="Open profile">üë§</button>
        <button class="quick-btn" id="themeBtn" title="Toggle theme">üåì</button>
      </div>
    </div>

    <div id="banner" class="banner" style="background-image:url('https://images.unsplash.com/photo-1526378727609-8f1b0f8d1d11?auto=format&fit=crop&w=1200&q=80')"></div>

    <div id="contentLoader"></div>
  </div>
</div>

<div class="cookie" id="cookie" style="display:none">
  <div style="font-size:14px">üç™ We use cookies to improve the site.</div>
  <div><button id="acceptCookie">Accept</button></div>
</div>

<!-- SUPABASE SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const supabaseUrl = 'https://rzdigwqgejbowdljuuei.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6ZGlnd3FnZWpib3dkbGp1dWVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2Mjc2MTgsImV4cCI6MjA3NzIwMzYxOH0.WlTlj3Vr4euv7EOzxNCNHB4rqZQeglPO07V9IBnUoJY';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// AUTH CHECK
async function runAuthCheck() {
  const { data } = await supabase.auth.getSession();
  if(!data.session) window.location.href = '/error.html';
}
document.addEventListener('DOMContentLoaded', runAuthCheck);

// Logout
document.getElementById('navLogout').addEventListener('click', async (e)=>{
  e.preventDefault();
  await supabase.auth.signOut();
  window.location.href = '/error.html';
});

// DYNAMIC LOADER
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
document.addEventListener('DOMContentLoaded', function() {
  const loader = $('#contentLoader');
  const defaultSection = 'home';

  async function loadFromHash() {
    const name = (location.hash && location.hash.startsWith('#')) ? location.hash.slice(1) : defaultSection;
    await loadSection(name);
  }

  async function loadSection(name) {
    if (!name) name = defaultSection;
    if (name === 'logout') return;
    try {
      loader.innerHTML = `<div style="padding:30px;text-align:center;color:var(--muted)">Loading ${name}‚Ä¶</div>`;
      const res = await fetch(`${name}.html`, {cache: "no-store"});
      if(!res.ok) throw new Error('Not found');
      const html = await res.text();
      loader.innerHTML = html;
      if(location.hash !== `#${name}`) history.replaceState(null,'',`#${name}`);
    } catch(err){
      loader.innerHTML = `<div class="card"><h3>Unable to load "${name}"</h3><p class="muted">Make sure <code>${name}.html</code> exists in the same folder.</p></div>`;
    }
  }

  $$('.nav a').forEach(a => {
    a.addEventListener('click', function(e){
      const section = a.getAttribute('data-section');
      if(section){
        e.preventDefault();
        loadSection(section);
        $$('.nav a').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
      }
    });
  });

  $('#btnNotifications').addEventListener('click', ()=> loadSection('notifications'));
  $('#btnProfile').addEventListener('click', ()=> loadSection('profile'));
  loadFromHash();
  window.addEventListener('hashchange', loadFromHash);
});

// UI: Sidebar collapse / theme / cookie
document.addEventListener('DOMContentLoaded', function(){
  const sidebar = $('#sidebar');
  $('.logo').addEventListener('dblclick', ()=> sidebar.classList.toggle('collapsed'));

  $('#themeBtn').addEventListener('click', ()=>{
    const isDark = document.body.getAttribute('data-theme')==='dark';
    if(isDark){ document.body.removeAttribute('data-theme'); localStorage.setItem('knowvion_theme','light'); }
    else { document.body.setAttribute('data-theme','dark'); localStorage.setItem('knowvion_theme','dark'); }
  });
  const pref = localStorage.getItem('knowvion_theme');
  if(pref==='dark') document.body.setAttribute('data-theme','dark');

  const cookie = $('#cookie');
  const accept = $('#acceptCookie');
  if(!localStorage.getItem('knowvion_cookies')) cookie.style.display='flex';
  accept.addEventListener('click', ()=>{
    localStorage.setItem('knowvion_cookies','yes');
    cookie.style.display='none';
  });
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/supertokens-auth-react/umd/supertokens-auth-react.js"></script>
<script>
  // Initialize SuperTokens session
  SuperTokens.init({
    appInfo: {
      appName: "KnownVion",
      apiDomain: "https://st-dev-0de5e681-b3d2-11f0-863b-bf368f3ebf48.aws.supertokens.io",
      websiteDomain: window.location.origin
    },
    recipeList: [ SuperTokens.Session.init() ]
  });

  // On page load: check if user is logged in
  (async function() {
    try {
      await SuperTokens.Session.getSession();
      // Session exists -> optionally execute any dashboard setup
      console.log("User session active, dashboard can be shown.");
    } catch (err) {
      // No session -> redirect to error page
      window.location.replace('error.html');
    }
  })();

  // Optional: if you have a logout button
  const logoutBtn = document.getElementById('logoutBtn'); // make sure button exists
  if(logoutBtn){
    logoutBtn.addEventListener('click', async () => {
      try { await SuperTokens.Session.signOut(); } catch (e) {}
      window.location.href = 'index.html'; // login page
    });
  }
</script>
</body>
</html>

