<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Knowvion — Dashboard</title>

<!-- Netlify Identity (required) -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  /* =======================
     VARIABLES / THEME
     ======================= */
  :root {
    --bg: #ffffff;       /* default background (white theme) */
    --text: #000000;     /* default text color */
    --card: #f5f6f7;     /* slab/card color */
    --muted: #6b6b6b;
    --accent: #000000;   /* icon / accent color */
    --shadow: 0 8px 24px rgba(0,0,0,0.08);
    --radius: 14px;
    --sidebar-collapsed-width: 70px;
    --sidebar-expanded-width: 220px;
    --banner-height: 120px; /* small top banner */
    --transition-fast: 160ms;
  }

  /* Dark theme variables (applied when .dark is on body) */
  body.dark {
    --bg: #000000;
    --text: #ffffff;
    --card: #0f0f10;
    --muted: #bdbdbd;
    --accent: #ffffff;
    --shadow: 0 10px 30px rgba(0,0,0,0.45);
  }

  /* =======================
     BASIC LAYOUT
     ======================= */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}

  .app {
    display:flex;
    height:100vh;
    width:100%;
    overflow:hidden;
  }

  /* =======================
     SIDEBAR
     ======================= */
  .sidebar {
    width: var(--sidebar-collapsed-width);
    min-width: var(--sidebar-collapsed-width);
    background: var(--card);
    padding: 16px 10px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    box-shadow: 4px 0 18px rgba(0,0,0,0.05);
    transition: width 200ms ease;
    position: fixed;
    left: 0; top: 0; bottom: 0;
    z-index: 30;
    border-top-right-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
    overflow: visible;
  }

  /* Expand on hover or when .open applied */
  .sidebar:hover,
  .sidebar.open {
    width: var(--sidebar-expanded-width);
  }

  .logo {
    width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:var(--bg);color:var(--accent);font-weight:600;font-size:16px;margin-bottom:6px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  }

  /* nav actions */
  .nav {
    width:100%;
    margin-top:8px;
    display:flex;flex-direction:column;gap:6px;
    padding: 4px 6px;
  }

  .nav button {
    --pad: 10px;
    display:flex;
    align-items:center;
    gap:12px;
    width:100%;
    padding:var(--pad);
    border-radius:12px;
    border: none;
    background: transparent;
    cursor:pointer;
    color:var(--text);
    transition: background var(--transition-fast), transform var(--transition-fast);
    font-weight:500;
    text-align: left;
    white-space:nowrap;
    overflow:visible;
  }

  .nav button:active { transform: translateY(1px); }
  .nav button:hover { background: rgba(0,0,0,0.04); }

  /* active state */
  .nav button.active {
    background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02));
    box-shadow: var(--shadow);
  }

  /* ICON (single-style monochrome line icons)
     - All icons are inline SVG with stroke=currentColor so color is consistent */
  .nav svg {
    width:22px;height:22px;flex:0 0 22px;color:var(--accent);
  }

  /* label is completely hidden when collapsed to avoid partial words */
  .nav .label {
    display:inline-block;
    opacity:0;
    transform: translateX(-6px);
    transition: opacity 160ms ease, transform 160ms ease;
    font-size:15px;
  }
  .sidebar:hover .nav .label,
  .sidebar.open .nav .label {
    opacity:1;
    transform: translateX(0);
  }

  /* Logout separate spacing */
  .nav .logout { margin-top:12px; }

  /* =======================
     TOPBAR / HEADER
     ======================= */
  .topbar {
    position: fixed;
    left: var(--sidebar-collapsed-width);
    right: 0;
    top: 12px;
    height: 44px;
    display:flex;
    align-items:center;
    justify-content:flex-end;
    padding:6px 18px;
    gap:12px;
    transition: left 200ms ease;
    z-index: 25;
  }
  .sidebar:hover ~ .topbar,
  .sidebar.open ~ .topbar {
    left: var(--sidebar-expanded-width);
  }

  .top-action {
    background: var(--card);
    border-radius: 10px;
    padding: 8px;
    border: none;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    display:flex;align-items:center;justify-content:center;
    width:44px;height:44px;
    transition: transform 120ms ease;
  }
  .top-action:hover { transform: translateY(-3px); }
  .top-action svg { width:20px;height:20px;color:var(--accent); }

  /* Theme toggle displayed on top-right slightly separate */
  .theme-toggle {
    background: transparent;
    border: 1px solid rgba(0,0,0,0.06);
    padding: 8px 10px;
    border-radius:10px;
    display:flex;align-items:center;gap:8px;
    cursor:pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    transition: background 140ms;
  }
  .theme-toggle:hover { background: rgba(0,0,0,0.03); }

  /* =======================
     MAIN CONTENT
     ======================= */
  .content {
    margin-left: var(--sidebar-collapsed-width);
    padding: 22px;
    padding-top: 76px; /* leave space for topbar */
    height: 100vh;
    overflow-y: auto;
    transition: margin-left 200ms ease;
  }
  .sidebar:hover ~ .content,
  .sidebar.open ~ .content { margin-left: var(--sidebar-expanded-width); }

  /* top banner (small strip) */
  .banner {
    width: 100%;
    height: var(--banner-height);
    border-radius: 12px;
    overflow: hidden;
    background: center/cover no-repeat;
    box-shadow: var(--shadow);
    margin-bottom: 18px;
  }

  /* sections */
  .grid {
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
    gap:16px;
    align-items:start;
  }

  .card {
    background: var(--card);
    border-radius: 12px;
    padding: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  }
  .card h3 { margin:0 0 8px 0; font-size:16px; }
  .muted { color:var(--muted); font-size:14px }

  /* expanded panel area (for profile/ai/courses) */
  .panel {
    background: var(--card);
    border-radius: 12px;
    padding: 18px;
    box-shadow: var(--shadow);
  }

  /* cookie */
  .cookie {
    position:fixed;right:18px;bottom:18px;background:var(--card);color:var(--text);padding:12px 14px;border-radius:10px;box-shadow:var(--shadow);display:flex;gap:10px;align-items:center;z-index:40;
  }
  .cookie button { background:var(--accent);color:var(--bg);border:none;padding:8px 10px;border-radius:8px;cursor:pointer }

  /* responsive tweaks */
  @media (max-width:820px){
    :root { --sidebar-collapsed-width:60px; --sidebar-expanded-width:160px; --banner-height:100px; }
    .topbar { top:8px; left: var(--sidebar-collapsed-width); right: 8px; }
    .content { padding:16px; padding-top:72px; }
  }
</style>
</head>
<body>
<div class="app" id="app">

  <!-- SIDEBAR (single-style inline SVG icons, stroke-based so color is consistent) -->
  <aside class="sidebar" id="sidebar" aria-label="Main navigation">
    <div class="logo" title="Knowvion">K</div>

    <nav class="nav" aria-hidden="false" id="nav">
      <!-- Home (left blank as requested) -->
      <button data-section="home" class="active" aria-pressed="true" title="Home">
        <!-- home outline -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11.5L12 5l9 6.5"/><path d="M5 21h14a1 1 0 0 0 1-1V10"/></svg>
        <span class="label">Home</span>
      </button>

      <!-- Profile -->
      <button data-section="profile" title="Profile">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-3-3.87"/><path d="M4 21v-2a4 4 0 0 1 3-3.87"/><circle cx="12" cy="7" r="4"/></svg>
        <span class="label">Profile</span>
      </button>

      <!-- AI Section -->
      <button data-section="ai" title="AI">
        <!-- robot / ai head -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="7" width="18" height="11" rx="2"/><path d="M7 7V5a2 2 0 1 1 4 0v2"/><path d="M17 7V5a2 2 0 1 0-4 0v2"/><path d="M8.5 12h.01M15.5 12h.01"/></svg>
        <span class="label">AI Section</span>
      </button>

      <!-- Courses -->
      <button data-section="courses" title="Courses">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h18"/><path d="M6 3h12v18H6z"/></svg>
        <span class="label">Courses</span>
      </button>

      <!-- Settings -->
      <button data-section="settings" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.3 17.9l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.66 0 1.23-.39 1.51-1a1.65 1.65 0 0 0-.33-1.82L3.3 5.3A2 2 0 1 1 6.13 2.47l.06.06A1.65 1.65 0 0 0 8 2.86h.09c.66 0 1.23.39 1.51 1a1.65 1.65 0 0 0 1.82.33L12 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 17.9 3.3l-.06.06a1.65 1.65 0 0 0-.33 1.82c.2.61.78 1 1.39 1h.09a2 2 0 0 1 0 4h-.09c-.61 0-1.19.39-1.39 1z"/></svg>
        <span class="label">Settings</span>
      </button>

      <!-- logout -->
      <button data-section="logout" class="logout" title="Logout">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><path d="M16 17l5-5-5-5"/><path d="M21 12H9"/></svg>
        <span class="label">Logout</span>
      </button>
    </nav>
  </aside>

  <!-- TOPBAR -->
  <div class="topbar" role="banner">
    <!-- theme toggle (top-right) -->
    <button class="theme-toggle" id="themeToggle" title="Toggle theme">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z"></path>
      </svg>
      <span style="font-size:13px;opacity:.9;margin-left:6px">Theme</span>
    </button>

    <!-- notification / profile quick actions -->
    <button class="top-action" id="topNotify" title="Notifications (open inside)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0 1 18.5 14.5V11a6.002 6.002 0 0 0-5-5.917V4a1 1 0 1 0-2 0v1.083A6.002 6.002 0 0 0 6 11v3.5c0 .538-.214 1.055-.595 1.455L4 17h11z"></path>
      </svg>
    </button>

    <button class="top-action" id="topProfile" title="Profile (open inside)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="8" r="4"></circle>
        <path d="M6 20v-1a6 6 0 0 1 12 0v1"></path>
      </svg>
    </button>
  </div>

  <!-- MAIN CONTENT -->
  <main class="content" id="content" role="main" aria-live="polite">
    <!-- banner (small strip) -->
    <div id="banner" class="banner" aria-hidden="false" style="background-image:url('https://images.unsplash.com/photo-1526378727609-8f1b0f8d1d11?auto=format&fit=crop&w=1200&q=80')"></div>

    <!-- DYNAMIC PANELS (single page) -->
    <div id="panels">

      <!-- HOME (left blank for user as requested) -->
      <section id="panel-home" class="panel" style="display:block">
        <!-- Intentionally left blank for user's own content -->
      </section>

      <!-- PROFILE -->
      <section id="panel-profile" class="panel" style="display:none">
        <h2>Profile</h2>
        <div class="card">
          <h3 id="profileName">Loading user…</h3>
          <p id="profileEmail" class="muted"></p>
          <div style="margin-top:12px;color:var(--muted)">Registered details and enrolled courses will appear here.</div>
        </div>
      </section>

      <!-- AI SECTION -->
      <section id="panel-ai" class="panel" style="display:none">
        <h2>AI Section</h2>
        <div class="grid" style="margin-top:8px">
          <div class="card">
            <h3>AI Tools</h3>
            <p class="muted">Quick utilities: Topic summarizer, Problem hint generator, Concept maps (placeholders).</p>
          </div>
          <div class="card">
            <h3>Live Assist</h3>
            <p class="muted">Connect your tools later (integrations available).</p>
          </div>
        </div>
      </section>

      <!-- COURSES -->
      <section id="panel-courses" class="panel" style="display:none">
        <h2>Courses</h2>
        <div class="grid" style="margin-top:8px">
          <div class="card">
            <h3>Course 1 — Advanced Mathematics</h3>
            <p class="muted">Algebra, calculus, number theory — structured for deep practice.</p>
          </div>
          <div class="card">
            <h3>Course 2 — Conceptual Physics</h3>
            <p class="muted">Motion, optics, modern physics — concept-first approach.</p>
          </div>
          <div class="card">
            <h3>Course 3 — Organic Chemistry</h3>
            <p class="muted">Mechanisms and reactions with revision sheets.</p>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="panel-settings" class="panel" style="display:none">
        <h2>Settings</h2>
        <div class="card">
          <h3>Account</h3>
          <p class="muted">Change password, manage profile (Netlify auth handles most).</p>
        </div>
        <div class="card">
          <h3>Appearance</h3>
          <p class="muted">Theme toggle is at top-right. You can also set preferences here later.</p>
        </div>
      </section>

      <!-- NOTIFICATIONS (inline panel used by top button) -->
      <section id="panel-notifications" class="panel" style="display:none">
        <h2>Notifications</h2>
        <div class="card">
          <p class="muted">No notifications yet. When new updates are published, they will show here.</p>
        </div>
      </section>

    </div>
  </main>

  <!-- COOKIE PERMISSION (minimal) -->
  <div class="cookie" id="cookie" style="display:none;">
    <div style="font-size:13px">🍪 We use cookies to improve your experience.</div>
    <div style="margin-left:8px">
      <button id="cookieAccept">Accept</button>
    </div>
  </div>

</div>

<!-- ===============================
     SCRIPT: behavior + Netlify auth
     =============================== -->
<script>
/* --------------
   UTILS
   -------------- */
const qs = sel => document.querySelector(sel);
const qsa = sel => Array.from(document.querySelectorAll(sel));

/* --------------
   AUTH CHECK (Netlify Identity)
   --------------
   - If not logged in: redirect to root (index.html)
   - If logged in: populate profile area
*/
function runAuthCheck() {
  // wait until netlifyIdentity is available
  if (typeof netlifyIdentity === 'undefined') {
    setTimeout(runAuthCheck, 50);
    return;
  }
  const user = netlifyIdentity.currentUser();
  if (!user) {
    // not logged in -> redirect to login page (index.html)
    alert("Please login to access the dashboard.");
    window.location.href = '/';
    return;
  }
  // populate profile
  const name = user.user_metadata && (user.user_metadata.full_name || user.user_metadata.name) ? (user.user_metadata.full_name || user.user_metadata.name) : (user.email || 'User');
  qs('#profileName').textContent = name;
  qs('#profileEmail').textContent = user.email || '';
}

// Run auth check on load
document.addEventListener('DOMContentLoaded', runAuthCheck);

/* --------------
   SIDEBAR NAV: load sections inside the page (no reload)
   -------------- */
const sections = ['home','profile','ai','courses','settings','notifications'];
function showSection(name) {
  // hide all
  sections.forEach(s => {
    const el = qs('#panel-' + s);
    if (el) el.style.display = 'none';
  });
  // show named
  const target = qs('#panel-' + name);
  if (target) target.style.display = 'block';
  // update active class on buttons
  qsa('.nav button').forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-section') === name);
  });
}

// attach nav buttons
qsa('.nav button').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.preventDefault();
    const section = btn.getAttribute('data-section');
    if (!section) return;
    if (section === 'logout') {
      if (typeof netlifyIdentity !== 'undefined') {
        netlifyIdentity.logout();
      } else {
        window.location.href = '/';
      }
      return;
    }
    // show the panel
    showSection(section);
    // if sidebar is not hovered, keep it collapsed — user can hover to expand
    // (no reload)
  });
});

/* top actions open sections */
qs('#topNotify').addEventListener('click', () => { showSection('notifications'); });
qs('#topProfile').addEventListener('click', () => { showSection('profile'); });

/* --------------
   THEME TOGGLE (top-right)
   - toggles body.dark class and stores preference in localStorage
   -------------- */
const themeToggle = qs('#themeToggle');
function applyTheme(pref) {
  if (pref === 'dark') document.body.classList.add('dark');
  else document.body.classList.remove('dark');
}
(function initTheme(){
  const stored = localStorage.getItem('knowvion_theme');
  applyTheme(stored || 'light');
})();
themeToggle.addEventListener('click', () => {
  const isDark = document.body.classList.toggle('dark');
  localStorage.setItem('knowvion_theme', isDark ? 'dark' : 'light');
});

/* --------------
   COOKIE CONSENT
   -------------- */
(function cookieInit(){
  const cookie = qs('#cookie');
  const accepted = localStorage.getItem('knowvion_cookies');
  if (!accepted) {
    cookie.style.display = 'flex';
  }
  qs('#cookieAccept').addEventListener('click', () => {
    localStorage.setItem('knowvion_cookies', 'yes');
    qs('#cookie').style.display = 'none';
  });
})();

/* --------------
   BANNER: small top image (16:12-ish)
   - you can update the image URL here or via CSS background-image on #banner
   -------------- */
// (already set inline in markup). Keep for future dynamic updates if needed.

/* --------------
   NETLIFY IDENTITY: events
   -------------- */
if (typeof netlifyIdentity !== 'undefined') {
  netlifyIdentity.on('login', user => {
    // when user logs in via widget, reload or re-run auth check
    runAuthCheck();
    netlifyIdentity.close();
  });
  netlifyIdentity.on('logout', () => {
    // go to index after logout
    window.location.href = '/';
  });
} else {
  // If script loads later, attach listeners after available
  const waitForIdentity = setInterval(() => {
    if (typeof netlifyIdentity !== 'undefined') {
      clearInterval(waitForIdentity);
      netlifyIdentity.on('login', user => { runAuthCheck(); netlifyIdentity.close(); });
      netlifyIdentity.on('logout', () => { window.location.href = '/'; });
    }
  }, 100);
}

/* --------------
   UX: ensure collapse doesn't show half labels
   - We used CSS such that .label is display:none (via opacity) when not hovered,
     so no partial words appear. Keep sidebar accessible via hover or adding .open.
   -------------- */

/* --------------
   INITIAL UI STATE: show home by default (left blank)
   -------------- */
showSection('home');

</script>
</body>
</html>
